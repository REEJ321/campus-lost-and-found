<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Student Sign Up - Lost & Found</title>
<style>
body { 
  font-family: Poppins, sans-serif; 
  background: url('https://i0.wp.com/metrocdodev.com/wp-content/uploads/2024/08/image-510.png?resize=1024%2C768&ssl=1') no-repeat center center fixed; 
  background-size: cover; 
  margin: 0; 
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}
body::before {
  content: '';
  position: fixed;
  top:0; left:0; right:0; bottom:0;
  background-color: rgba(0,0,0,0.5); /* dark overlay */
  z-index: -1;
}
.container { 
  background: rgba(255,255,255,0.95); 
  padding: 30px; 
  border-radius: 10px; 
  box-shadow: 0 2px 8px rgba(0,0,0,0.2); 
  width: 350px; 
}
input, button {
  width: 100%;
  box-sizing: border-box;
}
input { 
  padding: 10px; 
  margin-top: 10px; 
  border-radius: 6px; 
  border: 1px solid #ccc; 
}
button { 
  padding: 10px; 
  margin-top: 15px; 
  border: none; 
  background: #3498db; 
  color: #fff; 
  font-weight: bold; 
  border-radius: 6px; 
  cursor: pointer; 
}
button:hover { 
  background: #2980b9; 
}
h2 { 
  text-align: center; 
  margin: 0; 
}
p { 
  text-align: center; 
  margin-top: 10px; 
  font-size: 0.9rem; 
}
a { 
  color: #3498db; 
  text-decoration: none; 
}
a:hover { 
  text-decoration: underline; 
}
/* Show/Hide password icon */
.password-container {
  position: relative;
}
.password-container span {
  position: absolute;
  right: 10px;
  top: 50%;
  transform: translateY(-50%);
  cursor: pointer;
  user-select: none;
}
</style>
</head>
<body>
<div class="container">
  <h2>Student Sign Up</h2>
  <input type="text" id="fullName" placeholder="Full Name" required>
  <input type="text" id="studentId" placeholder="Student ID (optional)">
  <input type="email" id="email" placeholder="Email" required>
  
  <div class="password-container">
    <input type="password" id="password" placeholder="Password" required>
    <span id="togglePassword">ðŸ™ˆ</span>
  </div>
  
  <button id="signupBtn">Sign Up</button>
  <p>Already have an account? <a href="index.html">Login</a></p>
</div>

<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";
const supabase = createClient(
  "https://qypvwkxmtrfgnfhhcxia.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF5cHZ3a3htdHJmZ25maGhjeGlhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA3ODcxNjAsImV4cCI6MjA3NjM2MzE2MH0.Mdam3ABGs8eF0682iSuv6UAOAF7BOIWTzhTaz-w5m2s"
);

document.getElementById("signupBtn").addEventListener("click", async () => {
  const fullName = document.getElementById("fullName").value.trim();
  const studentId = document.getElementById("studentId").value.trim();
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value;

  if (!fullName || !email || !password) return alert("Please fill all required fields");

  // Sign up user
  const { data: signUpData, error: signUpError } = await supabase.auth.signUp({
    email,
    password,
    options: { data: { full_name: fullName, student_id: studentId } }
  });

  if (signUpError) return alert("Sign up failed: " + signUpError.message);

  // Insert profile with role 'student'
  const { error: profileError } = await supabase.from("user_profiles").insert({
    id: signUpData.user.id,
    email: signUpData.user.email,
    role: "student"
  });

  if (profileError) return alert("Failed to create profile: " + profileError.message);

  alert("Sign up successful! Please check your email to confirm your account.");
  location.href = "index.html";
});

// Toggle password visibility
const passwordInput = document.getElementById("password");
const toggle = document.getElementById("togglePassword");
toggle.addEventListener("click", () => {
  if (passwordInput.type === "password") {
    passwordInput.type = "text";
    toggle.textContent = "ðŸ™‰";
  } else {
    passwordInput.type = "password";
    toggle.textContent = "ðŸ™ˆ";
  }
});
</script>
</body>
</html>
